---
title: 服务端-常见问题 小记
date: 2021-07-25 17:12:40
tags:
---

### nginx 引起
#### fastcgi_read_timeout
1. 配置项
```bash
# 指定nginx接受后端fastcgi响应请求超时时间
fastcgi_read_timeout 8;
```
2. 超时 nginx 日志
```
upstream timed out (110: Connection timed out) while reading upstream,
```

3. 状态码
```http
504
```

### php 引起

#### request_terminate_timeout
1. 配置项
```bash
# php-fpm 接受的请求的超时时间，超过这个时间 php-fpm 会 kill 掉执行脚本的 worker 进程。
request_terminate_timeout
```
2. 超时 nginx 日志
```
recv() failed (104: Connection reset by peer) while reading response header from upstream
``` 
3. 超时 php-fpm 日志
```
[23-Jul-2021 15:34:17] WARNING: [pool www] child 24287, script '/work/web/file.superdalan.com/www/index.php' (request: "GET /index.php?s=/1916601d95a1e75f0b43ed00855dc669") execution timed out (30.992374 sec), terminating
[23-Jul-2021 15:34:17] WARNING: [pool www] child 24287 exited on signal 15 (SIGTERM) after 5340.190998 seconds from start
[23-Jul-2021 15:34:17] NOTICE: [pool www] child 12424 started
```

4. 状态码
```http
502
```

> 引用
[nginx 502 和 504 超时演示](http://wulfric.me/2018/07/nginx-demo/)